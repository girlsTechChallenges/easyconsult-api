# üè• EasyConsult API

**Servi√ßo de agendamento de consultas m√©dicas** desenvolvido em Java Spring Boot com Clean Architecture, GraphQL e Apache Kafka.

## üìã Sobre o Projeto

O **EasyConsult** √© uma aplica√ß√£o que permite gerenciar agendamentos de consultas entre pacientes e profissionais de sa√∫de de forma simples e eficiente.

## üöÄ Kafka + Docker

A aplica√ß√£o agora inclui **Apache Kafka** para mensageria ass√≠ncrona! 

### üìã Quick Start

```bash
# Suba a infraestrutura (PostgreSQL, Redis, Kafka)
docker-compose --profile infra up -d

# Execute a aplica√ß√£o localmente
./mvnw spring-boot:run

# Teste a API Kafka
curl -X POST "http://localhost:8081/api/kafka/publish-consult?message=Hello%20Kafka"
```

### üîß Servi√ßos Inclu√≠dos

| Servi√ßo | Porta | URL | Descri√ß√£o |
|---------|-------|-----|-----------|
| **EasyConsult API** | 8081 | http://localhost:8081 | API principal |
| **Kafka UI** | 8080 | http://localhost:8080 | Interface web do Kafka |
| **Kafka Broker** | 9092 | localhost:9092 | Message broker |
| **PostgreSQL** | 5432 | localhost:5432 | Banco principal |
| **Redis** | 6379 | localhost:6379 | Cache |

### üß™ Testando Kafka

```bash
# Via API REST
curl -X POST "http://localhost:8081/api/kafka/publish-consult?message=Hello%20Kafka"

# Via Interface Web do Kafka
# Acesse: http://localhost:8080
```

## üèóÔ∏è Arquitetura

O projeto segue **Clean Architecture** com separa√ß√£o clara de responsabilidades:

- **Core Domain**: Modelos de dom√≠nio (`Patient`, `Professional`, `Consult`)
- **Input Ports**: Interfaces dos casos de uso (`ConsultCommandUseCase`, `ConsultQueryUseCase`)
- **Output Ports**: Interfaces de gateways (`SaveGateway`, `FindByGateway`, `DeleteGateway`, `UpdateGateway`)
- **Infrastructure**: Implementa√ß√µes concretas (persist√™ncia, controladores, adapters)

## ‚ö° Stack Tecnol√≥gica

- **Java 21** - Linguagem principal
- **Spring Boot 3.5.5** - Framework web
- **GraphQL** - API principal para queries e mutations
- **Apache Kafka** - Sistema de mensageria ass√≠ncrona
- **PostgreSQL** - Banco de dados relacional
- **Redis** - Sistema de cache
- **Docker & Docker Compose** - Containeriza√ß√£o
- **Lombok** - Redu√ß√£o de boilerplate code
- **Maven** - Gerenciamento de depend√™ncias

## üîß Funcionalidades

### ‚úÖ Implementadas
- ‚ú® **Criar consultas** com dados do paciente, profissional, data/hora e motivo
- üîç **Buscar todas as consultas** com cache Redis
- üéØ **Filtrar consultas** por:
  - ID da consulta
  - ID do paciente
  - ID do profissional
  - Status da consulta
- ‚úèÔ∏è **Atualizar consultas** existentes com invalida√ß√£o de cache
- üóëÔ∏è **Deletar consultas** com limpeza completa de cache
- üîê **Autentica√ß√£o JWT** com roles de usu√°rio
- üíæ **Sistema de cache Redis** com estrat√©gias de invalida√ß√£o
- üì® **Integra√ß√£o Kafka** para mensageria ass√≠ncrona

## üß™ Cobertura de Testes

O projeto possui **cobertura completa de testes** seguindo as melhores pr√°ticas de TDD (Test-Driven Development):

### üìä Estat√≠sticas de Testes

| Categoria | Quantidade | Status | Cobertura |
|-----------|------------|--------|-----------|
| **üî¨ Testes Unit√°rios** | 94 | ‚úÖ 100% Pass | Completa |
| **üîß Testes de Integra√ß√£o** | 10 | ‚úÖ 100% Pass | Completa |
| **üöÄ Testes E2E** | 7 | ‚úÖ 100% Pass | Completa |
| **üìä Total** | **111** | ‚úÖ **100% Pass** | **100%** |

### üèóÔ∏è Arquitetura de Testes

#### üî¨ **Testes Unit√°rios** (94 testes)
- **Controllers**: Valida√ß√£o de mapeamentos GraphQL e REST
- **Use Cases**: L√≥gica de neg√≥cio isolada com mocks
- **Domain Models**: Valida√ß√£o de regras de dom√≠nio
- **Mappers**: Convers√µes entre DTOs e entidades

#### üîß **Testes de Integra√ß√£o** (10 testes)
- **Database Integration**: Opera√ß√µes CRUD com H2 in-memory
- **Cache Integration**: Valida√ß√£o do Redis com cache manager de teste
- **Kafka Integration**: Publica√ß√£o de eventos com mock service
- **Security Integration**: Autentica√ß√£o JWT e autoriza√ß√£o

#### üöÄ **Testes End-to-End** (7 testes)
- **GraphQL Queries**: Busca completa e filtrada de consultas
- **GraphQL Mutations**: CRUD completo via GraphQL
- **Authentication Flow**: Fluxo completo com JWT
- **Business Rules**: Valida√ß√£o de regras de neg√≥cio em cen√°rios reais

### üéØ **Cobertura por Componente**

| Componente | Unit√°rio | Integra√ß√£o | E2E | Status |
|------------|----------|------------|-----|---------|
| **GraphQL API** | ‚úÖ | ‚úÖ | ‚úÖ | 100% |
| **Use Cases** | ‚úÖ | ‚úÖ | ‚úÖ | 100% |
| **Gateways** | ‚úÖ | ‚úÖ | ‚úÖ | 100% |
| **Domain Models** | ‚úÖ | ‚úÖ | ‚úÖ | 100% |
| **JWT Security** | ‚úÖ | ‚úÖ | ‚úÖ | 100% |
| **Redis Cache** | ‚úÖ | ‚úÖ | ‚úÖ | 100% |
| **Kafka Events** | ‚úÖ Mock | ‚úÖ Mock | ‚úÖ Mock | 100% |

### **Executando Testes**

```bash
./mvnw test  # Todos os testes
./mvnw jacoco:report  # Relat√≥rio de cobertura
```

### üìã **Valida√ß√µes Inclu√≠das**

- ‚úÖ **Regras de Neg√≥cio**: Valida√ß√£o de conflitos de hor√°rio, dados obrigat√≥rios
- ‚úÖ **Cen√°rios de Erro**: Tratamento de exce√ß√µes e casos limite
- ‚úÖ **Performance**: Valida√ß√£o de cache e otimiza√ß√µes
- ‚úÖ **Seguran√ßa**: Autoriza√ß√£o por roles e valida√ß√£o JWT
- ‚úÖ **Integra√ß√µes**: Kafka, Redis, PostgreSQL via mocks/containers
- ‚úÖ **API Contract**: Valida√ß√£o completa dos contratos GraphQL



## üìä Status de Consulta

| Status | Descri√ß√£o |
|--------|-----------|
| `SCHEDULED` | Consulta agendada |
| `CARRIED_OUT` | Consulta realizada |
| `CANCELLED` | Consulta cancelada |

## üîê Seguran√ßa e Autentica√ß√£o

### JWT Authentication
A API utiliza autentica√ß√£o JWT com suporte a diferentes roles:

- **`SCOPE_medico`** - Profissionais m√©dicos
- **`SCOPE_enfermeiro`** - Profissionais de enfermagem  
- **`SCOPE_paciente`** - Pacientes

### Configura√ß√£o de Desenvolvimento
Durante o desenvolvimento, os endpoints GraphQL est√£o configurados como **p√∫blico** para facilitar os testes:
- `/graphql` - Endpoint principal
- `/graphiql` - Interface gr√°fica (habilitada apenas em dev)

### Cache Strategy
Sistema de cache Redis implementado com estrat√©gias de invalida√ß√£o:
- **Individual**: Cache por ID de consulta
- **Geral**: Cache de todas as consultas
- **Filtros**: Cache por crit√©rios de busca
- **Invalida√ß√£o**: Autom√°tica em opera√ß√µes de UPDATE/DELETE

## üöÄ Como Executar

### Pr√©-requisitos
- Java 21+
- Docker & Docker Compose
- Maven 3.9+

### Desenvolvimento Local

1. **Clone o reposit√≥rio:**
```bash
git clone https://github.com/girlsTechChallenges/easyconsult-api.git
cd easyconsult-api
```

2. **Suba a infraestrutura (PostgreSQL + Redis + Kafka):**
```bash
docker-compose --profile infra up -d
```

3. **Execute a aplica√ß√£o:**
```bash
./mvnw spring-boot:run
```

> A aplica√ß√£o ir√° iniciar automaticamente com o perfil `dev` ativo.

### üß™ Executando Testes

O projeto possui **111 testes** cobrindo todas as camadas:

```bash
./mvnw test  # Todos os testes
# Resultado: Tests run: 111, Failures: 0, Errors: 0, Skipped: 0
```

### üê≥ Docker (Produ√ß√£o)

```bash
# Ambiente completo (aplica√ß√£o + infraestrutura)
docker-compose --profile prod up -d

# Comandos √∫teis
docker-compose down                    # Parar containers
docker-compose down -v                 # Parar e remover volumes
docker-compose ps                      # Ver status
docker-compose logs -f app            # Logs da aplica√ß√£o
```

## üì® Apache Kafka Integration

### Classes Principais

1. **`KafkaProducerConfig`** - Configura√ß√£o Spring para o Kafka Producer
2. **`KafkaMessageService`** - Servi√ßo Spring para envio de mensagens de consultas
3. **`KafkaController`** - Controlador REST para testes via API
4. **`ConsultKafkaMessage`** - DTO para mensagens de consulta no Kafka

### ‚öôÔ∏è Configura√ß√£o

O projeto est√° configurado para usar o t√≥pico `easyconsult-consult` definido em `application.properties`:

```properties
# Kafka Topics Configuration
app.kafka.topics.consult=easyconsult-consult
app.kafka.groupid=group-consult
```

### üöÄ Como Usar o Kafka

#### 1. Integra√ß√£o Autom√°tica (Produ√ß√£o)

O Kafka √© **integrado automaticamente** no fluxo de cria√ß√£o de consultas. Sempre que uma nova consulta √© salva ou alterada, uma mensagem √© enviada automaticamente para o t√≥pico `easyconsult-consult`:

```java
// No SaveGatewayImpl - Executado automaticamente ao salvar ou alterar consulta
kafkaMessageService.publishConsultEvent(result);
```

A mensagem enviada cont√©m todos os dados da consulta:
```json
{
  "id": "123",
  "nameProfessional": "Dr. Silva",
  "patient": {
    "name": "Jo√£o Santos",
    "email": "joao@email.com"
  },
  "localTime": "14:30:00",
  "date": "2025-10-15",
  "reason": "Consulta de rotina",
  "statusConsult": "SCHEDULED"
}
```

#### 2. Via Endpoints REST (Para Testes)

```bash
# Teste manual de mensagem
POST /api/kafka/publish-consult?message=Teste%20de%20mensagem

# Exemplo via cURL
curl -X POST "http://localhost:8081/api/kafka/publish-consult?message=Teste%20Kafka"
```

### üìä Monitoramento do Kafka

#### **Kafka UI (Interface Web)**
Acesse: http://localhost:8080
- Visualizar t√≥picos
- Monitorar mensagens
- Gerenciar consumers
- Ver m√©tricas em tempo real

#### **Comandos CLI**
```bash
# Comandos b√°sicos do Kafka
docker exec kafka kafka-topics --bootstrap-server localhost:9092 --list
docker exec kafka kafka-console-consumer --bootstrap-server localhost:9092 --topic easyconsult-consult --from-beginning
```

### üîß Configura√ß√µes do Kafka

**Detec√ß√£o Autom√°tica de Ambiente**: O sistema detecta automaticamente se est√° rodando localmente ou em Docker:

```java
// KafkaProducerConfig.java
private String detectKafkaBootstrapServers() {
    String dockerEnv = System.getenv("DOCKER_ENV");
    String springProfile = System.getProperty("spring.profiles.active");
    
    if ("true".equals(dockerEnv) || "prod".equals(springProfile)) {
        return "kafka:29092"; // Docker
    }
    
    try {
        java.net.InetAddress.getByName("kafka");
        return "kafka:29092"; // Docker network
    } catch (java.net.UnknownHostException e) {
        return "localhost:9092"; // Local
    }
}
```

**Configura√ß√µes do Producer** (definidas no c√≥digo):
- **Confiabilidade**: `acks=all`, `retries=3`, `idempotence=true`
- **Performance**: `batch.size=16384`, `linger.ms=5`, `buffer.memory=33554432`
- **Serializa√ß√£o**: `StringSerializer` para chave e valor



## üì° GraphQL API

### üåê Endpoints Dispon√≠veis
- **GraphQL Endpoint**: `http://localhost:8081/graphql`
- **GraphiQL Interface**: `http://localhost:8081/graphiql` (Interface gr√°fica para testes)

### üîç Queries Dispon√≠veis

```graphql
# Buscar todas as consultas
query {
  getAllConsults {
    id
    reason
    statusConsult
    date
    localTime
    patient {
      name
      email
    }
    nameProfessional
  }
}

# Buscar consultas com filtros
query {
  getFilteredConsults(filter: {
    patientEmail: "joao@email.com"
    professionalEmail: "dr.silva@email.com"
    status: SCHEDULED
    date: "2025-10-15"
  }) {
    id
    reason
    statusConsult
    date
    localTime
    patient {
      name
      email
    }
    nameProfessional
  }
}
```

### ‚úèÔ∏è Mutations Dispon√≠veis

```graphql
# Criar nova consulta
mutation {
  createFullConsult(input: {
    reason: "Consulta de rotina"
    date: "2025-10-15"
    localTime: "14:30:00"
    patient: {
      name: "Jo√£o Silva"
      email: "joao@email.com"
    }
    professional: {
      name: "Dr. Silva"
      email: "dr.silva@email.com"
    }
  }) {
    id
    reason
    statusConsult
    date
    localTime
    patient {
      name
      email
    }
    nameProfessional
  }
}

# Atualizar consulta existente
mutation {
  updateConsult(input: {
    id: "1"
    reason: "Consulta de retorno"
    date: "2025-10-20"
    localTime: "15:00:00"
    status: SCHEDULED
    professional: {
      name: "Dr. Silva"
      email: "dr.silva@email.com"
    }
  }) {
    id
    reason
    statusConsult
    date
    localTime
  }
}

# Deletar consulta
mutation {
  deleteConsult(id: "1")
}
```

## üí° Exemplos Pr√°ticos

### Testando via GraphiQL
1. Acesse `http://localhost:8081/graphiql`
2. Use os exemplos abaixo para testar os endpoints

### Fluxo Completo de Teste

```graphql
# 1. Criar uma consulta
mutation CreateConsult {
  createFullConsult(input: {
    reason: "Consulta de rotina"
    date: "2025-10-15"
    localTime: "14:30:00"
    patient: {
      name: "Jo√£o Silva"
      email: "joao@email.com"
    }
    professional: {
      name: "Dr. Silva"
      email: "dr.silva@email.com"
    }
  }) {
    id
    reason
    statusConsult
    date
    localTime
  }
}

# 2. Buscar todas as consultas
query GetAllConsults {
  getAllConsults {
    id
    reason
    statusConsult
    date
    localTime
    patient {
      name
      email
    }
    nameProfessional
  }
}

# 3. Atualizar uma consulta
mutation UpdateConsult {
  updateConsult(input: {
    id: "1"
    reason: "Consulta de retorno - ATUALIZADA"
    date: "2025-10-20"
    localTime: "15:00:00"
    status: SCHEDULED
    professional: {
      name: "Dr. Silva"
      email: "dr.silva@email.com"
    }
  }) {
    id
    reason
    statusConsult
  }
}

# 4. Buscar por filtros
query FilterConsults {
  getFilteredConsults(filter: {
    patientEmail: "joao@email.com"
    status: SCHEDULED
  }) {
    id
    reason
    statusConsult
    patient {
      name
      email
    }
  }
}

# 5. Deletar consulta
mutation DeleteConsult {
  deleteConsult(id: "1")
}
```

## üì´ Testando com Postman

### üìÅ Estrutura Simplificada das Collections
O projeto possui apenas **2 arquivos Postman** otimizados:
```
postman/
‚îú‚îÄ‚îÄ EasyConsult.postman_collection.json     # üéØ Collection completa (GraphQL + Kafka)
‚îî‚îÄ‚îÄ EasyConsult.postman_environment.json    # üîê Environment com JWT tokens
```

### Importar Collection
1. Abra o Postman
2. Clique em **Import**
3. Selecione os 2 arquivos da pasta `postman/`:
   - `EasyConsult.postman_collection.json` - Collection completa (GraphQL + Kafka)
   - `EasyConsult.postman_environment.json` - Environment com tokens JWT
4. **Selecione o environment** "EasyConsult - Environment" no canto superior direito
5. Pronto! Uma √∫nica collection com tudo organizado!

### üîê Autentica√ß√£o JWT Configurada
**Problema do erro 403 resolvido!** Todos os endpoints t√™m tokens JWT v√°lidos:
- ‚úÖ `token_enfermeiro` - Para opera√ß√µes de cria√ß√£o de consultas (`createFullConsult`)
- ‚úÖ `token_medico` - Para opera√ß√µes de atualiza√ß√£o e exclus√£o (`updateConsult`, `deleteConsult`)
- ‚úÖ `token_paciente` - Para consultas filtradas por paciente (`getFilteredConsults`)
- ‚è∞ **Validade**: 1 ano (sem necessidade de renova√ß√£o durante desenvolvimento)

### Collection Inclui
- üìã **Queries** - Buscar consultas (todas, por ID, com filtros)
- ‚úèÔ∏è **Mutations** - Criar, atualizar e deletar consultas
- üß™ **Cen√°rios de Teste** - Fluxos completos e testes de filtros
- üîç **Schema Introspection** - An√°lise do schema GraphQL
- üì® **Kafka Producer** - Teste de publica√ß√£o de mensagens

### üö® Endpoints Kafka Dispon√≠veis
```bash
‚úÖ POST /api/kafka/publish-consult?message=sua_mensagem  
```



### üß™ Como Testar
1. **Importe** as collections atualizadas no Postman
2. **Selecione** o environment "EasyConsult - Environment"
3. **Configure** `base_url = http://localhost:8081` (j√° configurado)
4. **Execute** os testes - todos devem funcionar sem erros 403/404
5. **Para Kafka**, use o endpoint `publish-consult`

### ‚úÖ Status das Collections
- ‚úÖ **1 Collection √∫nica** (GraphQL + Kafka consolidados)
- ‚úÖ **1 Environment consolidado** (com todos os tokens)
- ‚úÖ **Estrutura simplificada** (m√°xima organiza√ß√£o)
- ‚úÖ **Endpoints inexistentes removidos**
- ‚úÖ **Schema GraphQL sincronizado**
- ‚úÖ **Testes validados**

## üìÅ Estrutura do Projeto

```
src/
‚îú‚îÄ‚îÄ main/java/com/fiap/easyconsult/
‚îÇ   ‚îú‚îÄ‚îÄ core/                           # Camada de dom√≠nio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model/                  # Entidades (UpdateConsult, etc.)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ valueobject/            # Value Objects (ConsultId, ConsultStatus)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inputport/                  # Interfaces de casos de uso
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ outputport/                 # Interfaces de gateways
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SaveGateway.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FindByGateway.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UpdateGateway.java      
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DeleteGateway.java      
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usecase/                    # Implementa√ß√£o dos casos de uso
‚îÇ   ‚îî‚îÄ‚îÄ infra/                          # Camada de infraestrutura
‚îÇ       ‚îú‚îÄ‚îÄ adapter/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ gateway/                # Implementa√ß√£o dos gateways
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ redis/                  # Cache management
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ kafka/                  # Mensageria
‚îÇ       ‚îú‚îÄ‚îÄ config/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ SecurityConfig.java     
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ JwtTokenProvider.java   # Autentica√ß√£o JWT
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ KafkaProducerConfig.java # Configura√ß√£o Kafka
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ CustomScalarConfig.java # GraphQL scalars
‚îÇ       ‚îú‚îÄ‚îÄ entrypoint/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ controller/             # GraphQL controllers + Kafka controller
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ dto/                    # DTOs de entrada/sa√≠da
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConsultUpdateRequestDto.java  
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ mapper/                 # Mapeamento de objetos
‚îÇ       ‚îî‚îÄ‚îÄ persistence/                # JPA entities e repositories
‚îî‚îÄ‚îÄ resources/
    ‚îú‚îÄ‚îÄ graphql/schema.graphqls         
    ‚îú‚îÄ‚îÄ application.properties          
    ‚îú‚îÄ‚îÄ application-dev.properties      
    ‚îî‚îÄ‚îÄ application-prod.properties     
```

## üß™ Testes Automatizados

O EasyConsult possui uma **su√≠te de testes de alta qualidade** seguindo **TDD (Test-Driven Development)** com cobertura completa das funcionalidades.

### üìã **Estrutura Organizada**

```
src/test/
‚îú‚îÄ‚îÄ java/com/fiap/easyconsult/
‚îÇ   ‚îú‚îÄ‚îÄ unit/                           üìÅ TESTES UNIT√ÅRIOS (8 arquivos)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/                 ‚úÖ Resolvers GraphQL
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/model/               ‚úÖ Regras de neg√≥cio (Consult, Patient, Professional)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/valueobject/         ‚úÖ Value Objects (ConsultStatus, ConsultDateTime)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usecase/                    ‚úÖ Casos de uso (Command + Query)
‚îÇ   ‚îî‚îÄ‚îÄ integration/                    üìÅ TESTES DE INTEGRA√á√ÉO (4 arquivos)
‚îÇ       ‚îú‚îÄ‚îÄ config/                     ‚úÖ Configura√ß√£o de seguran√ßa para testes
‚îÇ       ‚îú‚îÄ‚îÄ graphql/                    ‚úÖ Testes GraphQL completos
‚îÇ       ‚îú‚îÄ‚îÄ simple/                     ‚úÖ Context loading
‚îÇ       ‚îî‚îÄ‚îÄ usecase/                    ‚úÖ Integra√ß√£o de casos de uso
‚îî‚îÄ‚îÄ resources/
    ‚îî‚îÄ‚îÄ application-test.properties     ‚úÖ Profile de teste com H2
```

### üéØ **Funcionalidades Testadas**

#### **üî¨ Testes Unit√°rios (JUnit 5 + Mockito)**
- ‚úÖ **Regras de agendamento**: Valida√ß√µes de data/hora, campos obrigat√≥rios
- ‚úÖ **L√≥gica de cancelamento**: Apenas consultas SCHEDULED podem ser canceladas
- ‚úÖ **Transi√ß√µes de status**: SCHEDULED ‚Üí CANCELLED/COMPLETED/NO_SHOW
- ‚úÖ **Resolvers GraphQL**: Dados esperados e tratamento de erros
- ‚úÖ **Value Objects**: Valida√ß√µes de dom√≠nio e regras de neg√≥cio
- ‚úÖ **Use Cases**: Commands e Queries com mocks adequados

#### **üîó Testes de Integra√ß√£o (TestRestTemplate + H2)**
- ‚úÖ **Queries GraphQL**: `getAllConsults`, `getFilteredConsults` contra schema real
- ‚úÖ **Mutations GraphQL**: `createFullConsult`, `updateConsult`, `deleteConsult` com persist√™ncia
- ‚úÖ **Fluxos E2E**: Create ‚Üí Read ‚Üí Update ‚Üí Delete completos
- ‚úÖ **Tratamento de erros**: GraphQL errors, campos inv√°lidos, dados ausentes
- ‚úÖ **Schema validation**: Introspection e valida√ß√£o de tipos
- ‚úÖ **Status principal**: **6/6 testes GraphQL passando perfeitamente**


## ‚öôÔ∏è Configura√ß√£o de Ambiente

### Vari√°veis de Ambiente

| Vari√°vel | Desenvolvimento | Produ√ß√£o | Descri√ß√£o |
|----------|----------------|----------|-----------|
| `SPRING_PROFILES_ACTIVE` | `dev` | `prod` | Perfil ativo do Spring |
| `DATABASE_URL` | `localhost:5432` | `db:5432` | URL do PostgreSQL |
| `REDIS_HOST` | `localhost` | `redis` | Host do Redis |
| `JWT_SECRET` | Auto-gerado | Configurar | Chave secreta JWT |

### Arquivos de Configura√ß√£o

- `application.properties` - Configura√ß√µes base
- `application-dev.properties` - Desenvolvimento (localhost)  
- `application-prod.properties` - Produ√ß√£o (Docker containers)

### üîÑ Configura√ß√£o Autom√°tica

A aplica√ß√£o detecta automaticamente o ambiente:

- **Local**: Conecta em `localhost:9092`
- **Docker**: Conecta em `kafka:29092` (rede interna)

## üö® Troubleshooting

### Erro 403 Forbidden
Se encontrar erro 403 ao acessar `/graphql`:
1. Verifique se a aplica√ß√£o est√° rodando
2. Use a interface GraphiQL em `/graphiql`
3. Confirme que o perfil `dev` est√° ativo

### Problemas de Cache
Para limpar o cache Redis:
```bash
docker exec -it easyconsult-redis redis-cli FLUSHALL
```

### Problemas de Banco
Para resetar o banco PostgreSQL:
```bash
docker-compose down -v
docker-compose --profile infra up -d
```

### **Problema: Kafka n√£o inicia**
```bash
# Verificar logs do Zookeeper primeiro
docker-compose logs zookeeper

# Depois verificar logs do Kafka
docker-compose logs kafka

# Reiniciar servi√ßos na ordem correta
docker-compose restart zookeeper
sleep 10
docker-compose restart kafka
```

### **Problema: Aplica√ß√£o n√£o conecta no Kafka**
```bash
# Verificar se o Kafka est√° saud√°vel
docker-compose ps

# Testar conectividade
docker exec kafka kafka-topics --bootstrap-server kafka:29092 --list
```

### **Problema: Porta ocupada**
```bash
# Verificar portas em uso
netstat -tulpn | grep -E ':(8080|8081|9092|2181|5432|6379)'

# Parar servi√ßos conflitantes
docker-compose down
```

## üë• Time

Desenvolvido com ‚ù§Ô∏è pela equipe **Girls Tech Challenges**

### Funcionalidades Implementadas nesta Branch
- ‚úÖ **CRUD completo** para consultas via GraphQL
- ‚úÖ **Sistema de cache Redis** com invalida√ß√£o inteligente
- ‚úÖ **Integra√ß√£o Apache Kafka** para eventos de consulta
- ‚úÖ **Docker Compose** com stack completa (PostgreSQL, Redis, Kafka, Zookeeper)
- ‚úÖ **Kafka UI** para monitoramento em tempo real
- ‚úÖ **Clean Architecture** bem estruturada
- ‚úÖ **Testes automatizados** (unit√°rios e integra√ß√£o)
- ‚úÖ **Interface GraphiQL** para desenvolvimento
- ‚úÖ **Autentica√ß√£o JWT** configurada
- ‚úÖ **Detec√ß√£o autom√°tica** de ambiente (local/Docker)

---

## üìö Links √öteis

- [Apache Kafka Documentation](https://kafka.apache.org/documentation/)
- [Spring Kafka Reference](https://docs.spring.io/spring-kafka/docs/current/reference/html/)
- [GraphQL Documentation](https://graphql.org/learn/)
- [Spring Boot Documentation](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/)
- [Docker Compose Documentation](https://docs.docker.com/compose/)